<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="Author" content="Fujiwo">
    <meta name="Classification" content="Mahjong Flush Practice (麻雀 清一色の練習)">
    <meta name="Description" content="Mahjong Flush Practice (麻雀 清一色の練習)">
    <meta name="keywords" content="Mahjong,Flush,Practice,麻雀,清一色,練習">
    <title>Mahjong Flush Practice | Sho's Software [麻雀 清一色の練習 | 翔ソフトウェア (Sho's)]</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="chiniisou.min.css">
    <!-- <style>
        h1 {
            position: relative;
            padding: 5px 5px 5px 42px;
            background: #77c3df;
            font-size: 20px;
            color: white;
            margin-left: -33px;
            line-height: 1.3;
            z-index: -1;
        }

        h1:before {
            position: absolute;
            content: '';
            left: -2px;
            top: -2px;
            border: none;
            border-left: solid 40px white;
            border-bottom: solid 79px transparent;
            z-index: -2
        }
        .tile {
            font-size: 400%;
        }
    </style> -->
</head>
<body>
    <p class="navigator">
        <!-- for 翔ソフトウェア -->
        &lt;<a href="../index2.html">HOME</a>&gt; ― &lt;<a href="./document.html">ドキュメント</a>&gt; ― &lt;Mahjong Flush Practice (麻雀 清一色の練習)&gt;
        <img src="../css/image/line.jpg" width="100%" height="1" alt="LINE">
    </p>

    <p class="small">
        <script type="text/javascript">
            document.write("Last updated on " + document.lastModified + ".")
        </script>
    </p>
        <!--
        Mahjong - Wikipedia https://en.wikipedia.org/wiki/Mahjong
        Japanese Mahjong yaku - Wikipedia https://en.wikipedia.org/wiki/Japanese_Mahjong_yaku
        The Rules of Mah Jong or Mah Jongg https://www.mastersofgames.com/rules/mah-jong-rules.htm
     -->
    <h2 id="title"></h2>

    <table class="table">
        <thead>
            <tr>
                <th>
                    <span id="usingTileLabel"></span>:
                </th>
                <th>
                    <input id="usingTileCharacters" type="radio" name="usingTile" value="characters" checked>
                    <label for="usingTileCharacters"></label>
                    <input id="usingTileDots"type="radio" name="usingTile" value="dots">
                    <label for="usingTileDots"></label>
                    <input id="usingTileBomboos"type="radio" name="usingTile" value="bomboo">
                    <label for="usingTileBomboos"></label>
                </th>
            </tr>
            <tr>
                <th>
                    <span id="tileSizeLabel"></span>:
                </th>
                <th>
                    <input id="tileSizeSmall" type="radio" name="tileSize" value="small">
                    <label for="tileSizeSmall"></label>
                    <input id="tileSizeMedium" type="radio" name="tileSize" value="medium" checked>
                    <label for="tileSizeMedium"></label>
                    <input id="tileSizeLarge" type="radio" name="tileSize" value="large">
                    <label for="tileSizeLarge"></label>
                </th>
            </tr>
            <tr>
                <th>
                    <span id="languageLabel"></span>:
                </th>
                <th>
                    <input id="languageEnglish" type="radio" name="language" value="english" checked>
                    <label for="languageEnglish"></label>
                    <input id="languageJapanese" type="radio" name="language" value="japanese">
                    <label for="languageJapanese"></label>
                </th>
            </tr>
            <tr>
                <th>
                    <span id="sortingLabel">Sorting</span>:
                </th>
                <th>
                    <input id="sortingSorted" type="radio" name="sorting" value="sorted" checked>
                    <label for="sortingSorted"></label>
                    <input id="sortingUnsorted" type="radio" name="sorting" value="unsorted">
                    <label for="sortingUnsorted"></label>
                </th>
            </tr>
            <tr>
                <th colspan="2"><input id="nextButton"  type="button"></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td colspan="2"><div id="hands"></div></td>
            </tr>
        </tbody>
    </table>
    <div id="footer">
        <div><p class="copyright">Copyright &copy; 2020 Sho's Software</p></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <script src="chiniisou.min.js"></script>
    <!-- <script>
        const completeHandsNumber = 14;

        const charactersTileTextArray = [ '&#x1f007;', '&#x1f008;', '&#x1f009;', '&#x1f00a;', '&#x1f00b;',  '&#x1f00c;',  '&#x1f00d;',  '&#x1f00e;',  '&#x1f00f;'];
        const bambooTileTextArray     = [ '&#x1f010;', '&#x1f011;', '&#x1f012;', '&#x1f013;', '&#x1f014;',  '&#x1f015;',  '&#x1f016;',  '&#x1f017;',  '&#x1f018;'];
        const dotsTileTextArray       = [ '&#x1f019;', '&#x1f01a;', '&#x1f01b;', '&#x1f01c;', '&#x1f01d;',  '&#x1f01e;',  '&#x1f01f;',  '&#x1f020;',  '&#x1f021;'];

        const usingCharactersTile = 0;
        const usingBambooTile     = 1;
        const usingDotsTile       = 2;

        var usingTile = usingCharactersTile;

        function getTileTextArray() {
            switch (usingTile) {
                case usingBambooTile: return bambooTileTextArray    ;
                case usingDotsTile  : return dotsTileTextArray      ;
                default             : return charactersTileTextArray;
            }
        }

        function toTileText(handIndex) {
            return getTileTextArray()[handIndex];
        }

        function toTileHtml(hand) {
            let div = $("<div class = 'tile'>");
            hand.forEach(function(tileNumber, handIndex, self) {
                const tileText = toTileText(handIndex);
                for (var count = 0; count < tileNumber; count++)
                    div.append($('<span>').html(tileText));
            });
            return div;
        }

        function handIndexToHtml(handIndex) {
            let div = $("<div class = 'tile'>");
            const tileText = toTileText(handIndex);
            div.append($('<span>').html(tileText));
            return div;
        }

        function appendHandIndex(handIndex) {
            const div = handIndexToHtml(handIndex);
            $('#hands').append(div);
        }

        function handIndexesToHtml(handIndexes) {
            let div = $($("<div class = 'tile'>"));
            handIndexes.forEach(function(handIndex) {
                const tileText = toTileText(handIndex);
                div.append($('<span>').html(tileText));
            });
            return div;
        }

        function appendHandTo(element, hand) {
            //console.log("appendHand: " + hand);
            const div = toTileHtml(hand);
            element.append(div);
        }

        function appendHandIndexes(element, handIndexes) {
            const div = handIndexesToHtml(handIndexes);
            element.append(div);
        }

        function getAllHands() {
            var hands = [];
            for (var tileNumber1 = 0; tileNumber1 <= 4; tileNumber1++) {
                let tileNumberSum1 = tileNumber1;
                for (var tileNumber2 = 0; tileNumber2 <= 4; tileNumber2++) {
                    let tileNumberSum2 = tileNumberSum1 + tileNumber2;
                    for (var tileNumber3 = 0; tileNumber3 <= 4; tileNumber3++) {
                        let tileNumberSum3 = tileNumberSum2 + tileNumber3;
                        for (var tileNumber4 = 0; tileNumber4 <= 4; tileNumber4++) {
                            let tileNumberSum4 = tileNumberSum3 + tileNumber4;
                            if (tileNumberSum4 >= completeHandsNumber) {
                                if (tileNumberSum4 == completeHandsNumber)
                                    hands.push([tileNumber1, tileNumber2, tileNumber3, tileNumber4, 0, 0, 0, 0, 0]);
                                break;
                            }
                            for (var tileNumber5 = 0; tileNumber5 <= 4; tileNumber5++) {
                                let tileNumberSum5 = tileNumberSum4 + tileNumber5;
                                if (tileNumberSum5 >= completeHandsNumber) {
                                    if (tileNumberSum5 == completeHandsNumber)
                                        hands.push([tileNumber1, tileNumber2, tileNumber3, tileNumber4, tileNumber5, 0, 0, 0, 0]);
                                    break;
                                }
                                for (var tileNumber6 = 0; tileNumber6 <= 4; tileNumber6++) {
                                    let tileNumberSum6 = tileNumberSum5 + tileNumber6;
                                    if (tileNumberSum6 >= completeHandsNumber) {
                                        if (tileNumberSum6 == completeHandsNumber)
                                            hands.push([tileNumber1, tileNumber2, tileNumber3, tileNumber4, tileNumber5, tileNumber6, 0, 0, 0]);
                                        break;
                                    }
                                    for (var tileNumber7 = 0; tileNumber7 <= 4; tileNumber7++) {
                                        let tileNumberSum7 = tileNumberSum6 + tileNumber7;
                                        if (tileNumberSum7 >= completeHandsNumber) {
                                            if (tileNumberSum7 == completeHandsNumber)
                                                hands.push([tileNumber1, tileNumber2, tileNumber3, tileNumber4, tileNumber5, tileNumber6, tileNumber7, 0, 0]);
                                            break;
                                        }
                                        for (var tileNumber8 = 0; tileNumber8 <= 4; tileNumber8++) {
                                            let tileNumberSum8 = tileNumberSum7 + tileNumber8;
                                            if (tileNumberSum8 >= completeHandsNumber) {
                                                if (tileNumberSum8 == completeHandsNumber)
                                                    hands.push([tileNumber1, tileNumber2, tileNumber3, tileNumber4, tileNumber5, tileNumber6, tileNumber7, tileNumber8, 0]);
                                                break;
                                            }
                                            for (var tileNumber9 = 0; tileNumber9 <= 4; tileNumber9++) {
                                                let tileNumberSum9 = tileNumberSum8 + tileNumber9;
                                                if (tileNumberSum9 >= completeHandsNumber) {
                                                    if (tileNumberSum9 == completeHandsNumber)
                                                        hands.push([tileNumber1, tileNumber2, tileNumber3, tileNumber4, tileNumber5, tileNumber6, tileNumber7, tileNumber8, tileNumber9]);
                                                        // console.log([tileNumber1, tileNumber2, tileNumber3, tileNumber4, tileNumber5, tileNumber6, tileNumber7, tileNumber8, tileNumber9]);
                                                    break;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            return hands;
        }

        function isSevenPairs(hand) {
            for (var index = 0; index < hand.length; index++) {
                if (hand[index] != 0 && hand[index] != 2)
                    return false;
            }
            return true;
        }

        // [麻雀]簡単なあがり判定法 - Qiita https://qiita.com/tomohxx/items/20d886d1991ab89f5522
        function maybeCompleteHand(hand) {
            var a = hand[0];
            var b = hand[1];

            for (var i = 0; i < 7; i++) {
                let r = a % 3;
                if (b >= r && hand[i+2] >= r) {
                    a = b - r;
                    b = hand[i + 2] - r;
                } else {
                    return false;
                }
            }
            return a % 3 == 0 && b % 3 == 0;
        }

        function isCompleteHand(hand) {
            if (isSevenPairs(hand))
                return true;

            var p = 0;
            for (var i = 0; i < 9; i++)
                p += i * hand[i];

            for (var i = p * 2 % 3; i < 9; i+=3) {//ここでiを、牌の和を3で割った余りを2で割った数に初期化
                hand[i] -= 2;

                if (hand[i] >= 0) {
                    if (maybeCompleteHand(hand)) {
                        hand[i] += 2;
                        return true;
                    }
                }
                hand[i] += 2;
            }
            return false;
        }

        function getCompleteHands(allHands) {
            return allHands.filter(hand => isCompleteHand(hand));
        }

        function getRandomNumber(minimum, maximum) {
            return Math.floor(Math.random() * (maximum - minimum + 1)) + minimum;
        }

        function getRandomIndex(number) {
            return Math.floor(Math.random() * number);
        }

        function getRandomElement(array) {
            return array[getRandomIndex(array.length)];
        }

        function decrementHand(hand) {
            const randomIndex = getRandomIndex(completeHandsNumber);
            var index = 0;
            for (var handIndex = 0; handIndex < hand.length; handIndex++) {
                index += hand[handIndex];
                if (index > randomIndex) {
                    var clonedHand = Array.from(hand);
                    if (clonedHand[handIndex] == 0)
                        alert('Error: decrementHand');
                    else
                        clonedHand[handIndex]--;
                    return [clonedHand, handIndex];
                }
            }
            alert('Error: decrementHand');
        }

        function getReadyToWinHand(completeHand) {
            return decrementHand(completeHand)[0];
        }

        function appendHand(hand, handIndex) {
            var clonedHand = Array.from(hand);
            if (clonedHand[handIndex] < 4) {
                clonedHand[handIndex]++;
                return clonedHand;
            }
            return null;
        }

        function makeComplateHandIndexes(readyToWinHand) {
            var handIndexes = [];
            for (var handIndex = 0; handIndex < 9; handIndex++) {
                const hand = appendHand(readyToWinHand, handIndex);
                if (hand !== null && isCompleteHand(hand))
                    handIndexes.push(handIndex);                
            }
            return handIndexes;
        }
        
        function setHandlers() {
            $('input:radio[name="usingTile"]').change(function() {
                const value = $('input:radio[name="usingTile"]:checked').val();
                //alert("radio: " + value);
                switch (value) {
                    case "characters": usingTile = usingCharactersTile; break;
                    case "dots"      : usingTile = usingDotsTile      ; break;
                    case "bomboo"    : usingTile = usingBambooTile    ; break;
                }
            });

            $('#nextButton').on('click', function() {
                if (isQuestion) {
                    var completeHand = getRandomElement(completeHands);
                    readyToWinHand = getReadyToWinHand(completeHand);
                    $("#hands").html("");
                    $("#hands").append("<div>Question:</div>");
                    appendHandTo($("#hands"), readyToWinHand);
                } else {
                    const handIndexes = makeComplateHandIndexes(readyToWinHand);
                    $("#hands").append("<div>Answer:</div>");
                    appendHandIndexes($("#hands"), handIndexes);
                }
                isQuestion = !isQuestion;
            });
        }

        var isQuestion = true;
        var allHands;
        var completeHands;
        var readyToWinHand;

        function initializeHands() {
            allHands = getAllHands();
            completeHands = getCompleteHands(allHands);
            // const sevenPairsHands = completeHands.filter(hand => isSevenPairs(hand));
        }

        function main() {
            setHandlers();
            initializeHands();
        }

        $(document).ready(main);
    </script> -->
</body>
</html>
